"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[318],{3873:(e,r,s)=>{s.d(r,{x:()=>l});var t=s(5155),n=s(2115),a=s(6609);let c=["INITIALIZING SYSTEM...","ESTABLISHING CONNECTION...","SCANNING STAR SYSTEMS...","LOADING PLANET DATA...","FETCHING RESOURCES...","LOADING RESEARCH STATUS...","CHECKING STRUCTURES...","INITIALIZING GAME STATE..."];function l(e){let{message:r="SYSTEM BOOT SEQUENCE"}=e,[s,l]=(0,n.useState)(0),[i,o]=(0,n.useState)(0);return(0,n.useEffect)(()=>{let e=setInterval(()=>{l(r=>r>=100?(clearInterval(e),100):r+1)},30),r=setInterval(()=>{o(e=>(e+1)%c.length)},375);return()=>{clearInterval(e),clearInterval(r)}},[]),(0,t.jsxs)("div",{className:"min-h-screen bg-background cyber-grid flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-primary/5 blur-[100px] rounded-full"}),(0,t.jsxs)("div",{className:"w-[600px] space-y-8 z-10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,t.jsx)(a.A,{className:"h-8 w-8 text-primary animate-pulse"}),(0,t.jsx)("h1",{className:"text-4xl font-bold neon-text tracking-wider",children:r})]}),(0,t.jsxs)("div",{className:"relative h-[300px] border border-primary/30 bg-black/80 overflow-hidden font-mono",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(180deg,rgba(0,255,0,0.03)1px,transparent_1px)] bg-[size:100%_2px] animate-matrix-rain"}),(0,t.jsx)("div",{className:"p-4 space-y-2 text-primary/70",children:c.map((e,r)=>(0,t.jsxs)("div",{className:"transition-opacity duration-500 ".concat(r===i?"opacity-100":"opacity-30"),children:["> ",e]},r))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm text-primary/70 font-mono",children:[(0,t.jsx)("span",{children:"INITIALIZATION PROGRESS"}),(0,t.jsxs)("span",{children:[s,"%"]})]}),(0,t.jsxs)("div",{className:"relative h-2 bg-primary/10 rounded-full overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 bg-primary/30",style:{width:"".concat(s,"%")}}),(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 bg-primary animate-pulse",style:{width:"2px",left:"".concat(s,"%"),boxShadow:"0 0 10px theme(colors.primary.DEFAULT), 0 0 5px theme(colors.primary.DEFAULT)"}})]})]})]})]})}},7146:(e,r,s)=>{s.d(r,{A:()=>u,O:()=>o});var t=s(5155),n=s(2115),a=s(1712),c=s(6046),l=s(3873);let i=(0,n.createContext)(null);function o(e){let{children:r}=e,[s,o]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0),h=(0,c.useRouter)();(0,n.useEffect)(()=>{a.N.auth.getSession().then(e=>{var r;let{data:{session:s}}=e;o(null!==(r=null==s?void 0:s.user)&&void 0!==r?r:null),d(!1)});let{data:{subscription:e}}=a.N.auth.onAuthStateChange((e,r)=>{var s;o(null!==(s=null==r?void 0:r.user)&&void 0!==s?s:null)});return()=>e.unsubscribe()},[]);let p=async(e,r)=>{let{error:s}=await a.N.auth.signInWithPassword({email:e,password:r});if(s)throw s;h.push("/dashboard")},f=async()=>{await a.N.auth.signOut(),h.push("/auth/login")};return u?(0,t.jsx)(l.x,{}):(0,t.jsx)(i.Provider,{value:{isAuthenticated:!!s,authedUser:s,login:p,logout:f,loading:u},children:r})}function u(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},9318:(e,r,s)=>{s.d(r,{I:()=>u,S:()=>o});var t=s(5155),n=s(2115),a=s(1712),c=s(7146);let l=(0,n.createContext)(null),i={loading:!0,loadedResources:!1,loadedPlanets:!1,loadedStructures:!1,loadedStructuresConfig:!1,loadedResearchsConfig:!1,loadedShipsConfig:!1,loadedPlanetResearchs:!1,userPlanets:[],selectedPlanet:null,resources:null,structures:[],structuresConfig:null,researchsConfig:null,shipsConfig:null,activePlayers:0,planetResearchs:null,currentUser:null,planets:null};function o(e){var r;let{children:s}=e,[o,u]=(0,n.useState)(i),[d,h]=(0,n.useState)({metal:0,microchips:0,deuterium:0,science:0,energy_production:0,energy_consumption:0}),{authedUser:p}=(0,c.A)();return(0,n.useEffect)(()=>{if(!p){u(i),h({metal:0,microchips:0,deuterium:0,science:0,energy_production:0,energy_consumption:0});return}(async()=>{let{data:e,error:r}=await a.N.from("users").select("*").eq("id",p.id).single();if(r){console.error("Error fetching current user:",r);return}u(r=>({...r,currentUser:e}))})();let e=a.N.channel("users-channel").on("postgres_changes",{event:"*",schema:"public",table:"users",filter:"id=eq.".concat(p.id)},e=>{"DELETE"===e.eventType?u(e=>({...e,currentUser:null})):u(r=>({...r,currentUser:e.new}))}).subscribe();return()=>{e.unsubscribe()}},[p]),(0,n.useEffect)(()=>{let e=async()=>{if(!o.loadedPlanets)try{let{data:e,error:r}=await a.N.from("planets").select("*").order("created_at").range(0,999);if(r){console.error("Error fetching planets:",r);return}console.log("Loaded ".concat((null==e?void 0:e.length)||0," planets")),u(r=>({...r,planets:e,loadedPlanets:!0})),localStorage.setItem("planets_cache",JSON.stringify({planets:e,timestamp:Date.now()}))}catch(e){console.error("Error in fetchPlanets:",e)}};(()=>{let e=localStorage.getItem("planets_cache");if(!e)return console.log("No planets cache found"),!1;try{let{planets:r,timestamp:s}=JSON.parse(e);if(Date.now()-s<18e5)return console.log("Loaded ".concat((null==r?void 0:r.length)||0," planets from cache")),u(e=>({...e,planets:r,loadedPlanets:!0})),!0;console.log("Planet cache expired")}catch(e){console.error("Error parsing planets cache:",e)}return!1})()||e()},[o.loadedPlanets]),(0,n.useEffect)(()=>{if(!o.loadedPlanets)return;let e=a.N.channel("planet_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"planets",filter:"owner_id IS NOT NULL"},e=>{u(r=>{var s;return{...r,planets:(null===(s=r.planets)||void 0===s?void 0:s.map(r=>r.id===e.new.id?{...r,owner_id:e.new.owner_id}:r))||null}})}).subscribe();return()=>{e.unsubscribe()}},[o.loadedPlanets]),(0,n.useEffect)(()=>{if(!p)return;(async()=>{let{data:e,error:r}=await a.N.from("planets").select("*").eq("owner_id",p.id);if(r){console.error("Error fetching planets:",r);return}u(r=>({...r,userPlanets:e||[],selectedPlanet:o.selectedPlanet?o.selectedPlanet:(null==e?void 0:e.find(e=>e.is_homeworld))||null,loadedPlanets:!0,...(!e||0===e.length)&&{loadedResources:!0,loadedStructures:!0,loadedStructuresConfig:!0,loadedResearchsConfig:!0,loadedShipsConfig:!0,loadedPlanetResearchs:!0}}))})();let e=a.N.channel("planets-channel").on("postgres_changes",{event:"*",schema:"public",table:"planets",filter:"owner_id=eq.".concat(p.id)},e=>{u(r=>{let s=[...r.userPlanets];if("DELETE"===e.eventType)s=s.filter(r=>r.id!==e.old.id);else{let r=s.findIndex(r=>r.id===e.new.id);r>=0?s[r]=e.new:s.push(e.new)}let t=r.selectedPlanet;return!t&&s.length>0&&(t=s.find(e=>e.is_homeworld)||s[0]),{...r,userPlanets:s,selectedPlanet:t}})}).subscribe();return()=>{e.unsubscribe()}},[p,null===(r=o.selectedPlanet)||void 0===r?void 0:r.id]),(0,n.useEffect)(()=>{var e,r;if(!(null===(e=o.selectedPlanet)||void 0===e?void 0:e.id))return;(async()=>{var e;let{data:r,error:s}=await a.N.from("planets_resources").select("*").eq("planet_id",null===(e=o.selectedPlanet)||void 0===e?void 0:e.id);if(s){console.error("Error fetching planet resources:",s);return}u(e=>({...e,resources:r.at(0),loadedResources:!0}))})();let s=a.N.channel("resources-channel").on("postgres_changes",{event:"*",schema:"public",table:"planets_resources",filter:"planet_id=eq.".concat(null===(r=o.selectedPlanet)||void 0===r?void 0:r.id)},e=>{console.log("resources update"),u(r=>({...r,resources:e.new,loadedResources:!0}))}).subscribe();(async()=>{var e;let{data:r,error:s}=await a.N.from("planet_researchs").select("*").eq("planet_id",null===(e=o.selectedPlanet)||void 0===e?void 0:e.id).single();if(s){console.error("Error fetching planet research:",s);return}u(e=>({...e,planetResearchs:r||[],loadedPlanetResearchs:!0}))})();let t=a.N.channel("research-".concat(o.selectedPlanet.id)).on("postgres_changes",{event:"*",schema:"public",table:"planet_researchs",filter:"planet_id=eq.".concat(o.selectedPlanet.id)},e=>{u(r=>{switch(e.eventType){case"DELETE":return{...r,planetResearchs:null};case"INSERT":case"UPDATE":return{...r,planetResearchs:e.new};default:return r}})}).subscribe();return()=>{s.unsubscribe(),t.unsubscribe()}},[o.selectedPlanet]),(0,n.useEffect)(()=>{(async()=>{let{data:e,error:r}=await a.N.from("game_configs").select("*");if(r){console.error("Error fetching configs:",r);return}let s=null,t=null,n=null;for(let r of e)"structures"===r.id?s=r.config_data:"researchs"===r.id?t=r.config_data:"ships"===r.id&&(n=r.config_data);u(e=>({...e,structuresConfig:s,researchsConfig:t,shipsConfig:n,loadedStructuresConfig:!0,loadedResearchsConfig:!0,loadedShipsConfig:!0}))})();let e=a.N.channel("gameconfig-changes").on("postgres_changes",{event:"*",schema:"public",table:"game_configs",filter:"id=in.(structures,researchs,ships)"},e=>{u(r=>"structures"===e.new.id?{...r,structuresConfig:e.new.config_data}:"researchs"===e.new.id?{...r,researchsConfig:e.new.config_data}:"ships"===e.new.id?{...r,shipsConfig:e.new.config_data}:r)}).subscribe();return()=>{e.unsubscribe()}},[]),(0,n.useEffect)(()=>{if(!o.selectedPlanet)return;(async()=>{var e;let{data:r,error:s}=await a.N.from("structures").select("*").eq("planet_id",null===(e=o.selectedPlanet)||void 0===e?void 0:e.id);if(s){console.error("Error fetching structures:",s);return}u(e=>({...e,structures:r||[],loadedStructures:!0}))})();let e=a.N.channel("structures-".concat(o.selectedPlanet.id)).on("postgres_changes",{event:"*",schema:"public",table:"structures",filter:"planet_id=eq.".concat(o.selectedPlanet.id)},e=>{u(r=>{switch(e.eventType){case"DELETE":return{...r,structures:r.structures.filter(r=>r.id!==e.old.id)};case"INSERT":return{...r,structures:[...r.structures,e.new]};case"UPDATE":return{...r,structures:r.structures.map(r=>r.id===e.new.id?e.new:r)};default:return r}})}).subscribe();return()=>{e.unsubscribe()}},[o.selectedPlanet]),(0,n.useEffect)(()=>{o.loadedPlanets&&o.loadedResources&&o.loadedStructures&&o.loadedStructuresConfig&&o.loadedResearchsConfig&&o.loadedShipsConfig&&o.loadedPlanetResearchs&&u(e=>({...e,loading:!1}))},[o.loadedPlanets,o.loadedResources,o.loadedStructures,o.loadedStructuresConfig,o.loadedResearchsConfig,o.loadedShipsConfig,o.loadedPlanetResearchs]),(0,n.useEffect)(()=>{if(!o.resources||!o.selectedPlanet||!o.structuresConfig)return;h({metal:o.resources.metal,microchips:o.resources.microchips,deuterium:o.resources.deuterium,science:o.resources.science,energy_production:o.resources.energy_production,energy_consumption:o.resources.energy_consumption});let e=setInterval(()=>{if(!o.resources||!o.selectedPlanet||!o.structuresConfig)return;let e=Date.now(),r=(e-o.resources.last_update)/1e3,s=o.resources.energy_production-o.resources.energy_consumption,t=1;s<0&&(t=1-s/100);let n={...o.resources,metal:o.resources.metal>=o.resources.max_metal?o.resources.metal:Math.min(o.resources.max_metal,o.resources.metal+o.resources.metal_production_rate*r*t),microchips:o.resources.microchips>=o.resources.max_microchips?o.resources.microchips:Math.min(o.resources.max_microchips,o.resources.microchips+o.resources.microchips_production_rate*r*t),deuterium:o.resources.deuterium>=o.resources.max_deuterium?o.resources.deuterium:Math.min(o.resources.max_deuterium,o.resources.deuterium+o.resources.deuterium_production_rate*r*t),science:o.resources.science>=o.resources.max_science?o.resources.science:Math.min(o.resources.max_science,o.resources.science+o.resources.science_production_rate*r*t),energy_production:o.resources.energy_production,energy_consumption:o.resources.energy_consumption,last_update:e};h(n),u(e=>({...e,resources:{...e.resources,...n,last_update:Date.now()}}))},1e3);return()=>clearInterval(e)},[o.resources,o.selectedPlanet,o.structures,o.structuresConfig]),(0,n.useEffect)(()=>{if(!p)return;let e=a.N.channel("online-users",{config:{presence:{key:p.id}}});return e.on("presence",{event:"sync"},()=>{let r=Object.keys(e.presenceState()).length;u(e=>({...e,activePlayers:r}))}).on("presence",{event:"join"},()=>{u(e=>({...e,activePlayers:e.activePlayers+1}))}).on("presence",{event:"leave"},()=>{u(e=>({...e,activePlayers:Math.max(0,e.activePlayers-1)}))}).subscribe(async r=>{"SUBSCRIBED"===r&&await e.track({user_id:p.id,online_at:new Date().toISOString()})}),()=>{e.unsubscribe()}},[p]),(0,t.jsx)(l.Provider,{value:{state:o,selectPlanet:e=>{u(r=>({...r,selectedPlanet:e}))},currentResources:d},children:s})}function u(){let e=(0,n.useContext)(l);if(!e)throw Error("useGame must be used within a GameProvider");return e}},1712:(e,r,s)=>{s.d(r,{N:()=>t});let t=(0,s(5974).UU)("http://127.0.0.1:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}}]);